<ion-header class="header" [translucent]="true">
  <ion-toolbar>
    <div class="headercont">
      <div class="iconohead">
        <ion-img src="../../../assets/icon/logosinfondo.png"></ion-img>
      </div>
      <span class="headerttl">FERREMAS</span>
      
      <div class="header-buscador">
        <ion-searchbar 
          placeholder="Buscar pedidos..." 
          class="custom-searchbar"
          animated="true"
          showCancelButton="focus"
          debounce="500"
          (ionInput)="buscarPedidos($event)">
        </ion-searchbar>
      </div>
      
      <div class="headerderecha">
        <ion-button shape="round" class="headercerrar" href="/modificar-cuenta">{{ nombreUsuario || 'Editar Usuario' }}</ion-button>
        <ion-button shape="round" class="headercerrar" href="/iniciosin">Cerrar sesión</ion-button>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="titulo-cartas">
    <h1>Gestión de Pedidos</h1>
  </div>

  <!-- Filtros y controles -->
  <div class="filtros-container">
    <ion-segment value="todos" (ionChange)="filtrarPedidos($event)">
      <ion-segment-button value="todos">
        <ion-label>Todos</ion-label>
      </ion-segment-button>
      <ion-segment-button value="pendientes">
        <ion-label>Pendientes</ion-label>
      </ion-segment-button>
      <ion-segment-button value="enviados">
        <ion-label>Enviados</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Lista de pedidos -->
  <ion-list>
    <ion-item-group *ngFor="let pedido of pedidosFiltrados">
      <ion-item-divider sticky>
        <ion-label>
          Pedido #{{pedido.id}} - {{pedido.cliente}}
          <p>{{pedido.fecha | date:'mediumDate'}}</p>
        </ion-label>
        <div slot="end" class="estados-container">
          <ion-badge [color]="pedido.estado === 'Pendiente' ? 'warning' : 'success'">
            {{pedido.estado}}
          </ion-badge>
          <ion-badge [color]="pedido.pagado ? 'success' : 'danger'">
            {{pedido.pagado ? 'Pagado' : 'Pendiente pago'}}
          </ion-badge>
          <ion-badge *ngIf="pedido.pagado && pedido.metodoPago" color="medium">
            {{pedido.metodoPago}}
          </ion-badge>
        </div>
      </ion-item-divider>

      <ion-item *ngFor="let producto of pedido.productos">
        <ion-thumbnail slot="start">
          <ion-img [src]="producto.imagen || 'assets/icon/default-product.png'"></ion-img>
        </ion-thumbnail>
        <ion-label>
          <h3>{{producto.nombre}}</h3>
          <p>{{producto.cantidad}} x {{producto.precio | currency:'CLP':'symbol-narrow':'1.0-0'}}</p>
        </ion-label>
        <ion-note slot="end">{{producto.cantidad * producto.precio | currency:'CLP':'symbol-narrow':'1.0-0'}}</ion-note>
      </ion-item>

      <ion-item>
        <ion-label>Total del pedido</ion-label>
        <ion-note slot="end">{{calcularTotal(pedido) | currency:'CLP':'symbol-narrow':'1.0-0'}}</ion-note>
      </ion-item>

      <ion-item>
        <ion-label>Dirección de envío</ion-label>
        <ion-note slot="end">{{pedido.direccion}}</ion-note>
      </ion-item>

      <ion-item *ngIf="pedido.estado === 'Pendiente'">
        <ion-button slot="end" color="success" (click)="marcarComoEnviado(pedido)" [disabled]="!pedido.pagado">
          <ion-icon slot="start" name="checkmark-circle"></ion-icon>
          Marcar como enviado
        </ion-button>
        <ion-button *ngIf="!pedido.pagado" slot="end" color="tertiary" (click)="marcarComoPagado(pedido)">
          <ion-icon slot="start" name="cash"></ion-icon>
          Marcar como pagado
        </ion-button>
      </ion-item>
    </ion-item-group>

    <ion-item *ngIf="pedidosFiltrados.length === 0">
      <ion-label class="ion-text-center">No se encontraron pedidos</ion-label>
    </ion-item>
  </ion-list>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-grid>
      <ion-row class="footer-row">
        <ion-col size="6" class="footertxt">
          © FERREMAS 2025
        </ion-col>
        <ion-col size="6" class="footerinfo" style="text-align: right;">
          Contacto: +569 98940264
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-footer>