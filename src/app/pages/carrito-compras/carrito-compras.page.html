<ion-header class="header" [translucent]="true">
  <ion-toolbar>
    <div class="headercont">
      <div class="iconohead">
        <ion-img src="../../../assets/icon/logosinfondo.png"></ion-img>
      </div>
      <span class="headerttl" (click)="irAInicio()">FERREMAS</span>      
    <div class="headerderecha">      
    <ion-button shape="round" class="headercrear">Usuario: {{ nombreUsuario }}</ion-button>
    <ion-button shape="round" class="headercrear" (click)="guardarCarrito(); cerrarSesion()">Cerrar sesión</ion-button>
    </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="carrito-content">
  <div class="titulo-cartas">
    <h1>Carrito de compras</h1>
  </div>

  <ion-button shape="round" color="medium" (click)="togglePedidos()">
  {{ mostrarPedidos ? 'Ocultar pedidos' : 'Ver pedidos realizados' }}
</ion-button>

<div *ngIf="mostrarPedidos">
  <h2>Pedidos Realizados</h2>

  <ion-list *ngIf="pedidosConDetalle.length > 0">
    <ion-item *ngFor="let pedido of pedidosConDetalle">
      <ion-label>
        <h3>Pedido</h3>
        <p><strong>Descripción:</strong> {{ pedido.descripcion_carrito }}</p>
        <p><strong>Total:</strong> {{ pedido.precio_total | currency:'CLP' }}</p>
        <p><strong>Estado:</strong> {{ pedido.pago_comprobado }}</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <div *ngIf="pedidosConDetalle.length === 0">
    <p>No tienes pedidos registrados.</p>
  </div>
</div>

  <div class="carrito-box">

    <!-- Si el carrito está vacío -->
    <div *ngIf="carrito.length === 0" class="carrito-vacio">
      <p>Tu carrito está vacío.</p>
    </div>

    <!-- Lista de productos en formato boleta -->
    <div *ngFor="let producto of carrito; let i = index" class="producto-boleta">
      <div class="producto-header">
        <img [src]="'assets/icon/' + producto.titulo + '.png'" alt="{{ producto.titulo }}" class="producto-img" />
        <h3>{{ producto.titulo }}</h3>
        <ion-button (click)="eliminarDelCarrito(i)" class="btn-eliminar">Eliminar</ion-button>
      </div>

      <div class="producto-detalles">
        <div class="detalle-producto">
          <label>Cantidad:</label>
          <ion-input 
            type="number" 
            [value]="producto.cantidad" 
            (ionChange)="actualizarCantidad(i, $event)" 
            min="1" 
            max="5"
            [class.max-excedido]="producto.cantidad >= 5"
          ></ion-input>
          <span *ngIf="producto.cantidad >= 5" class="max-alert">(Máximo 5 unidades)</span>
        </div>

        <div class="detalle-producto">
          <label>Precio unitario:</label>
          <span>{{ producto.precio | currency:'CLP' }}</span>
        </div>

        <div class="detalle-producto">
          <label>Total:</label>
          <span>{{ producto.precio * producto.cantidad | currency:'CLP' }}</span>
        </div>
      </div>
      <hr class="separador" />
    </div>

    <!-- Botón pagar -->
    <div class="boton-pagar" *ngIf="carrito.length > 0">
      <ion-button expand="full" (click)="pagarCarrito(); guardarCarrito()">Pagar carrito ({{ calcularTotal() | currency:'CLP' }})</ion-button>
    </div>
  </div>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-grid>
      <ion-row class="footer-row">
        <ion-col size="6" class="footertxt">
          © FERREMAS 2025
        </ion-col>
        <ion-col size="6" class="footerinfo" style="text-align: right;">
          Contacto: +569 98940264
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-footer>
